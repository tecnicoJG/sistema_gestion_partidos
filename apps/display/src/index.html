<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Marcador Padel</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body class="page-loading">
    <div class="page-loading-overlay">
      <span class="loader"></span>
      <div>LOADING...</div>
    </div>
    <header>
      <div class="title">PISTA <span id="courtNumber">1</span></div>
      <div class="court-status" id="courtStatus">IN GAME</div>
      <div class="current-time" id="currentTime"></div>
    </header>
    <main>
      <section class="scoreboard">
        <div class="team is-loading">
          <div class="team-content">
            <div class="scores">
              <div class="score-container game-points">
                <div class="score-value" id="gamePointsValue-T1">15</div>
                <div class="score-label">POINTS</div>
              </div>
              <div class="score-container sets">
                <div class="score-value" id="setsValue-T1">1</div>
                <div class="score-label">SETS</div>
              </div>
              <div class="score-container games">
                <div class="score-value" id="gamesValue-T1">3</div>
                <div class="score-label">GAMES</div>
              </div>
            </div>
            <div class="players">
              <div class="player">
                <div class="player-name" id="playerName-T1P1">Player 1</div>
              </div>
              <div class="player">
                <div class="player-name" id="playerName-T1P2">Player 2</div>
              </div>
            </div>
          </div>
          <div class="team-loading">
            <span class="loader"></span>
            <div>WAITING FOR DATA...</div>
          </div>
        </div>
        <div class="team is-loading">
          <div class="team-content">
            <div class="scores">
              <div class="score-container game-points">
                <div class="score-value" id="gamePointsValue-T2">15</div>
                <div class="score-label">POINTS</div>
              </div>
              <div class="score-container sets">
                <div class="score-value" id="setsValue-T2">1</div>
                <div class="score-label">SETS</div>
              </div>
              <div class="score-container games">
                <div class="score-value" id="gamesValue-T2">3</div>
                <div class="score-label">GAMES</div>
              </div>
            </div>
            <div class="players">
              <div class="player">
                <div class="player-name" id="playerName-T2P1">Player 1</div>
              </div>
              <div class="player">
                <div class="player-name" id="playerName-T2P2">Player 2</div>
              </div>
            </div>
          </div>
          <div class="team-loading">
            <span class="loader"></span>
            <div>WAITING FOR DATA...</div>
          </div>
        </div>
      </section>
    </main>
    <footer>
      <img class="center-logo" src="logo.png" alt="Sport's center logo" />
      <div class="footer-message" id="footerMessage">Custom message here</div>
      <img class="product-logo" src="logo.png" alt="Product logo" />
    </footer>

    <script src="script.js"></script>
    <script>
      let score = {};

      function renamePlayer(name, team, player) {
        const playerNameContainer = document.getElementById(
          `player-${team}-${player}`
        );
        playerNameContainer.querySelectorAll("span").forEach((el) => {
          el.innerHTML = name;
        });
      }

      function initScrolling() {
        document.querySelectorAll(".player-name").forEach((el) => {
          const container = el.parentElement;

          // Remove scroll class & animation first
          container.classList.remove("scroll");
          el.style.animationDuration = "";
          el.style.animationPlayState = "";

          // Clear previous listener
          if (el._scrollListener) {
            el.removeEventListener("animationiteration", el._scrollListener);
            el._scrollListener = null;
          }

          // Clear previous timeout
          if (el._scrollTimeout) {
            clearTimeout(el._scrollTimeout);
            el._scrollTimeout = null;
          }

          // Only scroll if overflowing
          if (el.scrollWidth > container.clientWidth) {
            container.classList.add("scroll");

            const speed = 80; // px/s
            const pause = 5000; // ms
            const distance = el.scrollWidth / 2;
            const duration = distance / speed;

            el.style.setProperty("--scroll-distance", `-${distance}px`);
            el.style.animationDuration = `${duration}s`;

            // Start paused for initial delay
            el.style.animationPlayState = "paused";

            el._scrollTimeout = setTimeout(() => {
              el.style.animationPlayState = "running";
            }, pause);

            // Pause between loops
            const listener = () => {
              el.style.animationPlayState = "paused";
              el._scrollTimeout = setTimeout(() => {
                el.style.animationPlayState = "running";
              }, pause);
            };
            el.addEventListener("animationiteration", listener);
            el._scrollListener = listener;
          }
        });
      }

      // Initial run
      initScrolling();

      window.addEventListener("keydown", (e) => {
        switch (e.key) {
          case 1:
            break;
          case 2:
            break;
        }
      });

      // Debounced resize
      let resizeTimeout;
      window.addEventListener("resize", () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(initScrolling, 200);
      });

      function updateTime() {
        const now = new Date();

        // Format as HH:MM (24-hour)
        const hours = String(now.getHours()).padStart(2, "0");
        const minutes = String(now.getMinutes()).padStart(2, "0");

        const timeDiv = document.getElementById("currentTime");
        if (timeDiv) {
          timeDiv.textContent = `${hours}:${minutes}`;
        }

        // Calculate ms until next full minute
        const msToNextMinute =
          (60 - now.getSeconds()) * 1000 - now.getMilliseconds();
        setTimeout(updateTime, msToNextMinute);
      }

      // Start immediately
      updateTime();

      // Theme toggle handler
      function toggleTheme() {
        document.body.classList.toggle("dark-theme");
      }

      // Loading state handlers
      function clearPageLoading() {
        document.body.classList.remove("page-loading");
      }

      function clearTeamLoading(teamNumber) {
        const teams = document.querySelectorAll(".team");
        if (teamNumber >= 1 && teamNumber <= teams.length) {
          teams[teamNumber - 1].classList.remove("is-loading");
        }
      }

      // Keyboard controls
      window.addEventListener("keydown", (e) => {
        switch (e.key) {
          case "t": // Toggle theme
          case "T":
            toggleTheme();
            break;
          case "1": // Clear page loading
            clearPageLoading();
            break;
          case "2": // Clear team 1 loading
            clearTeamLoading(1);
            break;
          case "3": // Clear team 2 loading
            clearTeamLoading(2);
            break;
        }
      });
    </script>
  </body>
</html>
